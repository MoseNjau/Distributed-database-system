; =============================================================
; pgbouncer.ini — PgBouncer Connection Pooler Configuration
; Routes connections to PostgreSQL Primary
; =============================================================

[databases]
; Pool for the operational OLTP database
loans_db = host=postgres-primary port=5432 dbname=loans_db

; Pool for the warehouse database (read traffic)
warehouse_db = host=warehouse-db port=5432 dbname=warehouse_db

[pgbouncer]
; ── Network ──────────────────────────────────────────────────
listen_addr = *
listen_port = 5432
auth_type   = md5
auth_file   = /etc/pgbouncer/userlist.txt

; ── Pool Settings ────────────────────────────────────────────
pool_mode           = transaction       ; Most efficient for web/API apps
max_client_conn     = 200
default_pool_size   = 25
min_pool_size       = 5
reserve_pool_size   = 10
reserve_pool_timeout = 5

; ── Timeouts ─────────────────────────────────────────────────
server_connect_timeout   = 15
server_login_retry       = 15
client_idle_timeout      = 600
server_idle_timeout      = 600
query_timeout            = 300
query_wait_timeout       = 120

; ── Logging ──────────────────────────────────────────────────
logfile  = /var/log/pgbouncer/pgbouncer.log
pidfile  = /var/run/pgbouncer/pgbouncer.pid
log_connections    = 1
log_disconnections = 1
log_pooler_errors  = 1
stats_period       = 60

; ── Admin ────────────────────────────────────────────────────
admin_users  = postgres
stats_users  = postgres
